<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VADè¯­éŸ³æ´»åŠ¨æ£€æµ‹ - ä¼˜åŒ–ç‰ˆ</title>
    <meta name="description" content="åŸºäº@ricky0123/vad-webçš„è¯­éŸ³æ´»åŠ¨æ£€æµ‹ç¤ºä¾‹ï¼Œæ”¯æŒå®æ—¶å½•éŸ³å’ŒéŸ³é¢‘ä¿å­˜">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤</text></svg>">
    
    <!-- å¼‚æ­¥åŠ è½½VADåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.22.0/dist/ort.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.27/dist/bundle.min.js" defer></script>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .app-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-color);
        }
        
        .card h2 {
            color: var(--primary-color);
            margin-bottom: 16px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-danger {
            background: var(--error-color);
            color: white;
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-idle {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .status-listening {
            background: #dbeafe;
            color: var(--primary-color);
        }
        
        .status-recording {
            background: #dcfce7;
            color: var(--success-color);
        }
        
        .status-error {
            background: #fee2e2;
            color: var(--error-color);
        }
        
        .audio-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .audio-item {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .audio-item:last-child {
            margin-bottom: 0;
        }
        
        .audio-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .audio-title {
            font-weight: 600;
            color: var(--text-color);
        }
        
        .audio-meta {
            font-size: 12px;
            color: #6b7280;
        }
        
        .audio-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .audio-player {
            width: 100%;
            margin: 8px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .debug-panel {
            background: #1f2937;
            color: #d1d5db;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .app-container {
                padding: 16px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ğŸ¤ VADè¯­éŸ³æ´»åŠ¨æ£€æµ‹</h1>
            <p>åŸºäº@ricky0123/vad-webçš„å®æ—¶è¯­éŸ³æ£€æµ‹ä¸å½•éŸ³ç³»ç»Ÿ</p>
        </div>
        
        <!-- ç³»ç»ŸçŠ¶æ€å¡ç‰‡ -->
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="vadStatus" class="status-indicator status-idle">
                <span>ğŸ”„</span>
                <span>æ­£åœ¨åˆå§‹åŒ–VADåº“...</span>
            </div>
            <div id="vadInfo" style="margin-top: 12px;"></div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="card">
            <h2>ğŸ›ï¸ æ§åˆ¶é¢æ¿</h2>
            <div class="controls">
                <button id="startBtn" class="btn btn-primary" onclick="startVAD()" disabled>
                    <span>â–¶ï¸</span>
                    <span>å¼€å§‹ç›‘å¬</span>
                </button>
                <button id="stopBtn" class="btn btn-secondary" onclick="stopVAD()" disabled>
                    <span>â¹ï¸</span>
                    <span>åœæ­¢ç›‘å¬</span>
                </button>
                <button id="clearBtn" class="btn btn-secondary" onclick="clearRecordings()">
                    <span>ğŸ—‘ï¸</span>
                    <span>æ¸…ç©ºè®°å½•</span>
                </button>
                <button class="btn btn-secondary" onclick="toggleConfigPanel()">
                    <span>âš™ï¸</span>
                    <span>é…ç½®å‚æ•°</span>
                </button>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 16px;">
                <div class="status-indicator" id="listeningStatus">
                    <span>ğŸ”‡</span>
                    <span>æœªç›‘å¬</span>
                </div>
                <div class="status-indicator" id="recordingStatus">
                    <span>âšª</span>
                    <span>æœªå½•åˆ¶</span>
                </div>
                <div class="status-indicator" id="userSpeakingStatus">
                    <span>ğŸ”‡</span>
                    <span>æœªè¯´è¯</span>
                </div>
            </div>
            
            <!-- VADé…ç½®é¢æ¿ -->
            <div id="configPanel" style="display: none; margin-top: 16px; padding: 16px; background: #f8fafc; border-radius: 8px;">
                <h3 style="margin-bottom: 12px; color: #4b5563;">ğŸ”§ VADå‚æ•°é…ç½®</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">
                            è¯­éŸ³æ£€æµ‹é˜ˆå€¼ (0.1-0.9):
                        </label>
                        <input type="range" id="positiveThreshold" min="0.1" max="0.9" step="0.05" value="0.3" 
                               style="width: 100%;" onchange="updateConfigValue('positiveThreshold', this.value)">
                        <span id="positiveThresholdValue" style="font-size: 12px;">0.3</span>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">
                            éè¯­éŸ³æ£€æµ‹é˜ˆå€¼ (0.1-0.9):
                        </label>
                        <input type="range" id="negativeThreshold" min="0.1" max="0.9" step="0.05" value="0.25" 
                               style="width: 100%;" onchange="updateConfigValue('negativeThreshold', this.value)">
                        <span id="negativeThresholdValue" style="font-size: 12px;">0.25</span>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">
                            æœ€å°è¯­éŸ³æ—¶é•¿ (ms):
                        </label>
                        <input type="range" id="minSpeechMs" min="100" max="2000" step="100" value="400" 
                               style="width: 100%;" onchange="updateConfigValue('minSpeechMs', this.value)">
                        <span id="minSpeechMsValue" style="font-size: 12px;">400ms</span>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #6b7280;">
                            è¯­éŸ³å‰å¡«å…… (ms):
                        </label>
                        <input type="range" id="preSpeechPadMs" min="100" max="2000" step="100" value="800" 
                               style="width: 100%;" onchange="updateConfigValue('preSpeechPadMs', this.value)">
                        <span id="preSpeechPadMsValue" style="font-size: 12px;">800ms</span>
                    </div>
                </div>
                <div style="margin-top: 12px;">
                    <button class="btn btn-primary" onclick="applyVADConfig()" style="padding: 8px 16px; font-size: 12px;">
                        ğŸ’¾ åº”ç”¨é…ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="resetVADConfig()" style="padding: 8px 16px; font-size: 12px; margin-left: 8px;">
                        ğŸ”„ é‡ç½®é»˜è®¤
                    </button>
                </div>
            </div>
        </div>

        <!-- å½•éŸ³è®°å½• -->
        <div class="card">
            <h2>ğŸµ å½•éŸ³è®°å½•</h2>
            <div id="recordings" class="audio-list">
                <div style="text-align: center; color: #6b7280; padding: 40px;">
                    å½•éŸ³è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="card">
            <h2>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h2>
            <button class="btn btn-secondary" onclick="toggleDebug()" style="margin-bottom: 16px;">
                <span>ğŸ”</span>
                <span>æ˜¾ç¤º/éšè—è°ƒè¯•ä¿¡æ¯</span>
            </button>
            <div id="debugPanel" class="debug-panel" style="display: none;"></div>
        </div>

    <script>
        // å…¨å±€å˜é‡
        let vadInstance = null;
        let recordings = [];
        let debugMode = false;
        
        // VADé…ç½®å‚æ•°
        let vadConfig = {
            positiveSpeechThreshold: 0.3,
            negativeSpeechThreshold: 0.25,
            redemptionMs: 1400,
            preSpeechPadMs: 800,
            minSpeechMs: 400,
            model: "v5"
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–VAD
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ é¡µé¢DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–VAD...');
            logDebug('ç³»ç»Ÿåˆå§‹åŒ–å¼€å§‹');
            initVAD();
        });

        // åˆå§‹åŒ–VAD
        function initVAD() {
            logDebug('æ£€æŸ¥VADåº“åŠ è½½çŠ¶æ€...');
            
            // æ£€æŸ¥VADåº“æ˜¯å¦å·²åŠ è½½
            if (window.vad && window.vad.MicVAD) {
                // æ£€æŸ¥VADå®ä¾‹çš„åŠ è½½çŠ¶æ€
                if (vadInstance && !vadInstance.loading) {
                    logDebug('âœ… VADåº“å·²åŠ è½½å®Œæˆ');
                    updateVADStatus('ready', 'âœ… VADåº“å·²åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹ç›‘å¬');
                    addDebugLog('VADåº“åŠ è½½å®Œæˆ');
                }
                enableControls();
                showVADInfo();
                
                // æ£€æŸ¥éº¦å…‹é£æƒé™
                checkMicrophonePermission();
            } else {
                logDebug('â³ VADåº“è¿˜åœ¨åŠ è½½ä¸­...');
                updateVADStatus('loading', 'ğŸ”„ VADåº“åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...');
                
                // ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ç­–ç•¥ï¼‰
                setTimeout(initVAD, 1000);
            }
        }

        // æ£€æŸ¥éº¦å…‹é£æƒé™
        async function checkMicrophonePermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                logDebug('âœ… éº¦å…‹é£æƒé™å·²è·å–');
                updateVADStatus('ready', 'âœ… VADå·²å°±ç»ªï¼Œéº¦å…‹é£æƒé™æ­£å¸¸');
            } catch (error) {
                logDebug('âŒ éº¦å…‹é£æƒé™è·å–å¤±è´¥: ' + error.message);
                updateVADStatus('error', 'âŒ éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·å…è®¸éº¦å…‹é£è®¿é—®');
                showError('éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®å¹¶åˆ·æ–°é¡µé¢');
            }
        }

        // æ›´æ–°VADçŠ¶æ€æ˜¾ç¤º
        function updateVADStatus(status, message) {
            const statusDiv = document.getElementById('vadStatus');
            statusDiv.className = `status-indicator status-${status}`;
            statusDiv.innerHTML = `<span>${getStatusIcon(status)}</span><span>${message}</span>`;
            logDebug(`çŠ¶æ€æ›´æ–°: ${status} - ${message}`);
        }

        // è·å–çŠ¶æ€å›¾æ ‡
        function getStatusIcon(status) {
            const icons = {
                'ready': 'âœ…',
                'loading': 'ğŸ”„',
                'error': 'âŒ',
                'listening': 'ğŸ§',
                'recording': 'ğŸ”´'
            };
            return icons[status] || 'âšª';
        }

        // æ˜¾ç¤ºVADä¿¡æ¯
        function showVADInfo() {
            const infoDiv = document.getElementById('vadInfo');
            const modelInfo = vadInstance ? `å½“å‰ä½¿ç”¨: ${vadInstance.model || 'v5'}` : 'æœªåˆå§‹åŒ–';
            
            infoDiv.innerHTML = `
                <div style="margin-top: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 14px;">
                    <strong>ğŸ“‹ ç³»ç»Ÿä¿¡æ¯:</strong><br>
                    <div style="margin-top: 8px;">
                        <span style="color: #6b7280;">VADåº“çŠ¶æ€:</span> <span style="color: #10b981;">å·²åŠ è½½</span><br>
                        <span style="color: #6b7280;">MicVADç±»:</span> <span style="color: #10b981;">å¯ç”¨</span><br>
                        <span style="color: #6b7280;">ç‰ˆæœ¬:</span> 0.0.27<br>
                        <span style="color: #6b7280;">ONNX Runtime:</span> 1.22.0<br>
                        <span style="color: #6b7280;">é‡‡æ ·ç‡:</span> 16kHz<br>
                        <span style="color: #6b7280;">å£°é“:</span> å•å£°é“<br>
                        <span style="color: #6b7280;">æ¨¡å‹:</span> <span style="color: #10b981;">${modelInfo}</span>
                    </div>
                </div>
                <div style="margin-top: 8px; padding: 12px; background: #f0f9ff; border-radius: 8px; font-size: 12px; color: #0369a1;">
                    <strong>ğŸ’¡ ä¼˜åŒ–ç‰¹æ€§:</strong><br>
                    â€¢ ä½¿ç”¨Silero V5æ¨¡å‹ï¼ˆæ›´é«˜ç²¾åº¦ï¼‰<br>
                    â€¢ å®æ—¶è¯­éŸ³æ¦‚ç‡ç›‘æ§<br>
                    â€¢ è¯¯è§¦å‘æ£€æµ‹å¤„ç†<br>
                    â€¢ è‡ªå®šä¹‰éŸ³é¢‘æµé…ç½®<br>
                    â€¢ èµ„æºè‡ªåŠ¨æ¸…ç†
                </div>
            `;
        }
        
        // æ›´æ–°VADå®ä¾‹ä¿¡æ¯æ˜¾ç¤º
        function updateVADInstanceInfo() {
            if (vadInstance) {
                const infoDiv = document.getElementById('vadInfo');
                const existingInfo = infoDiv.querySelector('.vad-instance-info');
                
                if (existingInfo) {
                    existingInfo.remove();
                }
                
                const instanceInfo = document.createElement('div');
                instanceInfo.className = 'vad-instance-info';
                instanceInfo.style.cssText = `
                    margin-top: 8px; 
                    padding: 8px; 
                    background: #ecfdf5; 
                    border-radius: 6px; 
                    font-size: 12px;
                    color: #047857;
                `;
                instanceInfo.innerHTML = `
                    <strong>ğŸ¯ VADå®ä¾‹çŠ¶æ€:</strong><br>
                    â€¢ ç›‘å¬çŠ¶æ€: ${vadInstance.listening ? 'âœ… è¿è¡Œä¸­' : 'â¸ï¸ å·²æš‚åœ'}<br>
                    â€¢ ç”¨æˆ·è¯´è¯çŠ¶æ€: ${vadInstance.userSpeaking ? 'ğŸ¤ æ­£åœ¨è¯´è¯' : 'ğŸ”‡ æœªè¯´è¯'}<br>
                    â€¢ åŠ è½½çŠ¶æ€: ${vadInstance.loading ? 'ğŸ”„ åŠ è½½ä¸­' : 'âœ… å·²åŠ è½½'}<br>
                    â€¢ é”™è¯¯çŠ¶æ€: ${vadInstance.errored ? 'âŒ ' + (vadInstance.errored.message || 'æœªçŸ¥é”™è¯¯') : 'âœ… æ­£å¸¸'}
                `;
                infoDiv.appendChild(instanceInfo);
            }
        }

        // å¯ç”¨æ§åˆ¶æŒ‰é’®
        function enableControls() {
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            logDebug('æ§åˆ¶æŒ‰é’®å·²å¯ç”¨');
        }

        // å¼€å§‹VADç›‘å¬
        async function startVAD() {
            if (!window.vad || !window.vad.MicVAD) {
                showError('VADåº“è¿˜æœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•');
                return;
            }

            try {
                logDebug('å¼€å§‹åˆ›å»ºVADå®ä¾‹...');
                updateVADStatus('loading', 'ğŸ”„ æ­£åœ¨å¯åŠ¨è¯­éŸ³æ£€æµ‹...');

                // åˆ›å»ºVADå®ä¾‹ - æ ¹æ®å®˜æ–¹æ–‡æ¡£æœ€ä½³å®è·µï¼Œæ·»åŠ æ›´å¤šé…ç½®é€‰é¡¹
                vadInstance = await window.vad.MicVAD.new({
                    onSpeechStart: () => {
                        logDebug('ğŸ¤ æ£€æµ‹åˆ°è¯­éŸ³å¼€å§‹');
                        updateRecordingStatus('ğŸ”´ æ­£åœ¨å½•åˆ¶è¯­éŸ³');
                        addDebugLog('è¯­éŸ³æ£€æµ‹å¼€å§‹');
                    },
                    onSpeechRealStart: () => {
                        logDebug('ğŸ¤ æ£€æµ‹åˆ°å®é™…è¯­éŸ³å¼€å§‹ï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰');
                        addDebugLog('å®é™…è¯­éŸ³å¼€å§‹æ£€æµ‹');
                    },
                    onSpeechEnd: (audioData) => {
                        logDebug('â¹ï¸ æ£€æµ‹åˆ°è¯­éŸ³ç»“æŸ');
                        updateRecordingStatus('âšª è¯­éŸ³ç»“æŸ');
                        
                        // å¤„ç†å½•åˆ¶çš„éŸ³é¢‘æ•°æ®
                        if (audioData && audioData.length > 0) {
                            logDebug(`éŸ³é¢‘æ•°æ®é•¿åº¦: ${audioData.length} é‡‡æ ·ç‚¹`);
                            processAudioData(audioData);
                        } else {
                            logDebug('âš ï¸ VADæ²¡æœ‰æä¾›éŸ³é¢‘æ•°æ®');
                        }
                        addDebugLog('è¯­éŸ³æ£€æµ‹ç»“æŸ');
                    },
                    onFrameProcessed: (probabilities, frame) => {
                        // å®æ—¶æ˜¾ç¤ºè¯­éŸ³æ£€æµ‹æ¦‚ç‡
                        if (debugMode) {
                            const speechProb = (probabilities.isSpeech * 100).toFixed(1);
                            addDebugLog(`è¯­éŸ³æ¦‚ç‡: ${speechProb}%`);
                        }
                    },
                    onVADMisfire: () => {
                        logDebug('âš ï¸ VADè¯¯è§¦å‘æ£€æµ‹');
                        addDebugLog('VADè¯¯è§¦å‘ï¼ˆè¯­éŸ³ç‰‡æ®µè¿‡çŸ­ï¼‰');
                    },
                    // ç®—æ³•é…ç½®å‚æ•°ï¼ˆä½¿ç”¨ç”¨æˆ·é…ç½®ï¼‰
                    positiveSpeechThreshold: vadConfig.positiveSpeechThreshold,  // è¯­éŸ³æ£€æµ‹é˜ˆå€¼
                    negativeSpeechThreshold: vadConfig.negativeSpeechThreshold, // éè¯­éŸ³æ£€æµ‹é˜ˆå€¼
                    redemptionMs: vadConfig.redemptionMs,            // è¯­éŸ³æ£€æµ‹æ¢å¤æ—¶é—´
                    preSpeechPadMs: vadConfig.preSpeechPadMs,           // è¯­éŸ³å‰å¡«å……æ—¶é—´
                    minSpeechMs: vadConfig.minSpeechMs,              // æœ€å°è¯­éŸ³æ—¶é•¿
                    submitUserSpeechOnPause: false, // æš‚åœæ—¶æ˜¯å¦æäº¤è¯­éŸ³
                    model: vadConfig.model,                   // ä½¿ç”¨æ–°ç‰ˆSilero V5æ¨¡å‹
                    
                    // éŸ³é¢‘æµé…ç½®
                    getStream: async () => {
                        // è‡ªå®šä¹‰éŸ³é¢‘æµè·å–ï¼Œæ·»åŠ æ›´å¤šéŸ³é¢‘çº¦æŸ
                        return navigator.mediaDevices.getUserMedia({
                            audio: {
                                channelCount: 1,
                                echoCancellation: true,
                                autoGainControl: true,
                                noiseSuppression: true,
                                sampleRate: 16000
                            }
                        });
                    },
                    
                    // èµ„æºè·¯å¾„é…ç½®
                    onnxWASMBasePath: "https://cdn.jsdelivr.net/npm/onnxruntime-web@1.22.0/dist/",
                    baseAssetPath: "https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.27/dist/"
                });

                // å¼€å§‹ç›‘å¬
                vadInstance.start();
                updateListeningStatus('ğŸ§ æ­£åœ¨ç›‘å¬è¯­éŸ³...');
                
                // å¼€å§‹å®æ—¶çŠ¶æ€è½®è¯¢
                startStatusPolling();
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                
                logDebug('âœ… VADç›‘å¬å·²å¯åŠ¨');
                updateVADStatus('ready', 'âœ… VADæ­£åœ¨è¿è¡Œä¸­');
                addDebugLog('VADç›‘å¬å¯åŠ¨æˆåŠŸ');
                
                // æ›´æ–°VADå®ä¾‹ä¿¡æ¯æ˜¾ç¤º
                updateVADInstanceInfo();
                
            } catch (error) {
                console.error('å¯åŠ¨VADå¤±è´¥:', error);
                logDebug('âŒ VADå¯åŠ¨å¤±è´¥: ' + error.message);
                updateVADStatus('error', 'âŒ VADå¯åŠ¨å¤±è´¥: ' + error.message);
                showError('å¯åŠ¨è¯­éŸ³æ£€æµ‹å¤±è´¥: ' + error.message);
                addDebugLog('VADå¯åŠ¨å¤±è´¥: ' + error.message);
            }
        }

        // åœæ­¢VADç›‘å¬
        async function stopVAD() {
            try {
                if (vadInstance) {
                    // æ£€æŸ¥VADå®ä¾‹æ˜¯å¦æ­£åœ¨ç›‘å¬
                    if (vadInstance.listening) {
                        // å¦‚æœè®¾ç½®äº†submitUserSpeechOnPauseä¸ºtrueï¼Œè¿™é‡Œä¼šè§¦å‘onSpeechEnd
                        vadInstance.pause();
                        logDebug('VADå®ä¾‹å·²æš‚åœ');
                    }
                    
                    // å®Œå…¨é”€æ¯VADå®ä¾‹ä»¥é‡Šæ”¾èµ„æº
                vadInstance = null;
            }
            
            updateListeningStatus('ğŸ”‡ æœªç›‘å¬');
            updateRecordingStatus('âšª æœªå½•åˆ¶');
            
            // åœæ­¢çŠ¶æ€è½®è¯¢
            stopStatusPolling();
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                
                logDebug('âœ… VADç›‘å¬å·²åœæ­¢');
                updateVADStatus('ready', 'âœ… VADå·²åœæ­¢ï¼Œå¯é‡æ–°å¼€å§‹');
                addDebugLog('VADç›‘å¬å·²åœæ­¢');
                
                // æ›´æ–°VADå®ä¾‹ä¿¡æ¯æ˜¾ç¤º
                updateVADInstanceInfo();
                
                // å¼ºåˆ¶åƒåœ¾å›æ”¶æç¤ºï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰
                if (window.gc) {
                    window.gc();
                    logDebug('å¼ºåˆ¶åƒåœ¾å›æ”¶å·²è§¦å‘');
                }
                
            } catch (error) {
                console.error('åœæ­¢VADæ—¶å‘ç”Ÿé”™è¯¯:', error);
                logDebug('âŒ åœæ­¢VADå¤±è´¥: ' + error.message);
                showError('åœæ­¢è¯­éŸ³æ£€æµ‹å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°ç›‘å¬çŠ¶æ€
        function updateListeningStatus(message) {
            const statusDiv = document.getElementById('listeningStatus');
            const isListening = vadInstance ? vadInstance.listening : false;
            statusDiv.innerHTML = `<span>${getStatusIcon(isListening ? 'listening' : 'idle')}</span><span>${message}</span>`;
            statusDiv.className = `status-indicator ${isListening ? 'status-listening' : 'status-idle'}`;
        }

        // æ›´æ–°å½•åˆ¶çŠ¶æ€
        function updateRecordingStatus(message) {
            const statusDiv = document.getElementById('recordingStatus');
            const isRecording = vadInstance ? vadInstance.userSpeaking : false;
            statusDiv.innerHTML = `<span>${getStatusIcon(isRecording ? 'recording' : 'idle')}</span><span>${message}</span>`;
            statusDiv.className = `status-indicator ${isRecording ? 'status-recording' : 'status-idle'}`;
            
            // å®æ—¶æ˜¾ç¤ºuserSpeakingçŠ¶æ€
            const userSpeakingStatus = document.getElementById('userSpeakingStatus');
            if (userSpeakingStatus) {
                userSpeakingStatus.textContent = isRecording ? 'ğŸ¤ æ­£åœ¨è¯´è¯' : 'ğŸ”‡ æœªè¯´è¯';
                userSpeakingStatus.className = isRecording ? 'status-recording' : 'status-idle';
            }
        }
        
        // å®æ—¶è½®è¯¢æ›´æ–°userSpeakingçŠ¶æ€
        let statusPollingInterval = null;
        function startStatusPolling() {
            if (statusPollingInterval) {
                clearInterval(statusPollingInterval);
            }
            
            statusPollingInterval = setInterval(() => {
                if (vadInstance) {
                    // å®æ—¶æ›´æ–°å½•åˆ¶çŠ¶æ€æ˜¾ç¤º
                    const isRecording = vadInstance.userSpeaking;
                    updateRecordingStatus(isRecording ? 'ğŸ”´ æ­£åœ¨å½•åˆ¶è¯­éŸ³' : 'âšª è¯­éŸ³ç»“æŸ');
                    
                    // åœ¨æ§åˆ¶å°æ˜¾ç¤ºå®æ—¶çŠ¶æ€ï¼ˆç”¨äºè°ƒè¯•ï¼‰
                    if (debugMode && isRecording) {
                        console.log('ğŸ¤ å®æ—¶æ£€æµ‹åˆ°ç”¨æˆ·æ­£åœ¨è¯´è¯');
                    }
                }
            }, 100); // æ¯100æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡
        }
        
        function stopStatusPolling() {
            if (statusPollingInterval) {
                clearInterval(statusPollingInterval);
                statusPollingInterval = null;
            }
        }

        // å¤„ç†éŸ³é¢‘æ•°æ®å¹¶ä¿å­˜ä¸ºWAVæ–‡ä»¶
        function processAudioData(audioData) {
            logDebug('å¼€å§‹å¤„ç†éŸ³é¢‘æ•°æ®...');
            
            try {
                // å°†Float32ArrayéŸ³é¢‘æ•°æ®è½¬æ¢ä¸ºWAVæ ¼å¼
                const wavBlob = audioDataToWav(audioData);
                
                // åˆ›å»ºéŸ³é¢‘URLç”¨äºæ’­æ”¾
                const audioUrl = URL.createObjectURL(wavBlob);
                
                // è®¡ç®—éŸ³é¢‘æ—¶é•¿
                const duration = (audioData.length / 16000).toFixed(2);
                
                // åˆ›å»ºå½•éŸ³è®°å½•
                const recording = {
                    id: Date.now(),
                    timestamp: new Date(),
                    audioUrl: audioUrl,
                    duration: duration,
                    fileName: `vad-recording-${new Date().toISOString().replace(/[:.]/g, '-')}.wav`
                };
                
                // æ·»åŠ åˆ°å½•éŸ³è®°å½•æ•°ç»„
                recordings.unshift(recording);
                
                // æ›´æ–°å½•éŸ³è®°å½•æ˜¾ç¤º
                updateRecordingsDisplay();
                
                logDebug(`âœ… éŸ³é¢‘æ–‡ä»¶å·²ç”Ÿæˆ: ${recording.fileName}, æ—¶é•¿: ${duration}ç§’`);
                addDebugLog(`å½•éŸ³å®Œæˆ: ${duration}ç§’`);
                
            } catch (error) {
                console.error('å¤„ç†éŸ³é¢‘æ•°æ®å¤±è´¥:', error);
                logDebug('âŒ å¤„ç†éŸ³é¢‘æ•°æ®å¤±è´¥: ' + error.message);
                showError('å¤„ç†å½•éŸ³æ•°æ®å¤±è´¥: ' + error.message);
            }
        }
        
        // æ›´æ–°å½•éŸ³è®°å½•æ˜¾ç¤º
        function updateRecordingsDisplay() {
            const recordingsDiv = document.getElementById('recordings');
            
            if (recordings.length === 0) {
                recordingsDiv.innerHTML = `
                    <div style="text-align: center; color: #6b7280; padding: 40px;">
                        å½•éŸ³è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                    </div>
                `;
                return;
            }
            
            recordingsDiv.innerHTML = recordings.map(recording => `
                <div class="audio-item" data-id="${recording.id}">
                    <div class="audio-header">
                        <div class="audio-title">
                            ğŸµ å½•éŸ³ ${recording.timestamp.toLocaleString()}
                        </div>
                        <div class="audio-meta">
                            æ—¶é•¿: ${recording.duration}ç§’
                        </div>
                    </div>
                    <div class="audio-controls">
                        <audio class="audio-player" controls>
                            <source src="${recording.audioUrl}" type="audio/wav">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                        </audio>
                        <a href="${recording.audioUrl}" download="${recording.fileName}" 
                           class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;">
                            ğŸ“¥ ä¸‹è½½
                        </a>
                        <button onclick="deleteRecording(${recording.id})" 
                                class="btn btn-danger" style="padding: 8px 16px; font-size: 12px;">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // åˆ é™¤å½•éŸ³è®°å½•
        function deleteRecording(id) {
            const index = recordings.findIndex(rec => rec.id === id);
            if (index !== -1) {
                // é‡Šæ”¾éŸ³é¢‘URL
                URL.revokeObjectURL(recordings[index].audioUrl);
                recordings.splice(index, 1);
                updateRecordingsDisplay();
                logDebug(`å½•éŸ³è®°å½•å·²åˆ é™¤: ${id}`);
                addDebugLog(`åˆ é™¤å½•éŸ³è®°å½•: ${id}`);
            }
        }

        // æ¸…ç©ºæ‰€æœ‰å½•éŸ³è®°å½•
        function clearRecordings() {
            if (recordings.length === 0) {
                showInfo('æ²¡æœ‰å½•éŸ³è®°å½•éœ€è¦æ¸…ç©º');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å½•éŸ³è®°å½•å—ï¼Ÿå…± ${recordings.length} æ¡è®°å½•`)) {
                // é‡Šæ”¾æ‰€æœ‰éŸ³é¢‘URL
                recordings.forEach(rec => URL.revokeObjectURL(rec.audioUrl));
                recordings = [];
                updateRecordingsDisplay();
                logDebug('æ‰€æœ‰å½•éŸ³è®°å½•å·²æ¸…ç©º');
                addDebugLog('æ¸…ç©ºæ‰€æœ‰å½•éŸ³è®°å½•');
                showInfo('å½•éŸ³è®°å½•å·²æ¸…ç©º');
            }
        }

        // å°†Float32ArrayéŸ³é¢‘æ•°æ®è½¬æ¢ä¸ºWAVæ ¼å¼
        function audioDataToWav(audioData) {
            const sampleRate = 16000; // VADä½¿ç”¨16kHzé‡‡æ ·ç‡
            const numChannels = 1;   // å•å£°é“
            
            // è®¡ç®—WAVæ–‡ä»¶å¤§å°
            const buffer = new ArrayBuffer(44 + audioData.length * 2);
            const view = new DataView(buffer);
            
            // WAVæ–‡ä»¶å¤´
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + audioData.length * 2, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, audioData.length * 2, true);
            
            // å†™å…¥éŸ³é¢‘æ•°æ®ï¼ˆ16ä½PCMï¼‰
            let offset = 44;
            for (let i = 0; i < audioData.length; i++) {
                const sample = Math.max(-1, Math.min(1, audioData[i]));
                view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                offset += 2;
            }
            
            return new Blob([buffer], { type: 'audio/wav' });
        }

        // è¾…åŠ©å‡½æ•°ï¼šå†™å…¥å­—ç¬¦ä¸²åˆ°DataView
        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // è°ƒè¯•åŠŸèƒ½
        function logDebug(message) {
            if (debugMode) {
                console.log(`[DEBUG] ${message}`);
            }
        }

        function addDebugLog(message) {
            if (!debugMode) return;
            
            const debugPanel = document.getElementById('debugPanel');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            debugPanel.appendChild(logEntry);
            debugPanel.scrollTop = debugPanel.scrollHeight;
        }

        function toggleDebug() {
            debugMode = !debugMode;
            const debugPanel = document.getElementById('debugPanel');
            const debugBtn = document.querySelector('button[onclick="toggleDebug()"]');
            
            if (debugMode) {
                debugPanel.style.display = 'block';
                debugBtn.innerHTML = '<span>ğŸ‘ï¸</span><span>éšè—è°ƒè¯•ä¿¡æ¯</span>';
                addDebugLog('è°ƒè¯•æ¨¡å¼å·²å¼€å¯');
            } else {
                debugPanel.style.display = 'none';
                debugBtn.innerHTML = '<span>ğŸ”</span><span>æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</span>';
                logDebug('è°ƒè¯•æ¨¡å¼å·²å…³é—­');
            }
        }

        // é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ef4444;
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                max-width: 300px;
            `;
            errorDiv.innerHTML = `âŒ ${message}`;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }

        function showInfo(message) {
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                max-width: 300px;
            `;
            infoDiv.innerHTML = `â„¹ï¸ ${message}`;
            document.body.appendChild(infoDiv);
            
            setTimeout(() => {
                if (infoDiv.parentNode) {
                    infoDiv.parentNode.removeChild(infoDiv);
                }
            }, 3000);
        }

        // é…ç½®é¢æ¿ç›¸å…³å‡½æ•°
        function toggleConfigPanel() {
            const configPanel = document.getElementById('configPanel');
            const isVisible = configPanel.style.display !== 'none';
            configPanel.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                // æ˜¾ç¤ºé¢æ¿æ—¶åŠ è½½å½“å‰é…ç½®
                loadCurrentConfig();
            }
        }
        
        function loadCurrentConfig() {
            document.getElementById('positiveThreshold').value = vadConfig.positiveSpeechThreshold;
            document.getElementById('positiveThresholdValue').textContent = vadConfig.positiveSpeechThreshold;
            
            document.getElementById('negativeThreshold').value = vadConfig.negativeSpeechThreshold;
            document.getElementById('negativeThresholdValue').textContent = vadConfig.negativeSpeechThreshold;
            
            document.getElementById('minSpeechMs').value = vadConfig.minSpeechMs;
            document.getElementById('minSpeechMsValue').textContent = vadConfig.minSpeechMs + 'ms';
            
            document.getElementById('preSpeechPadMs').value = vadConfig.preSpeechPadMs;
            document.getElementById('preSpeechPadMsValue').textContent = vadConfig.preSpeechPadMs + 'ms';
        }
        
        function updateConfigValue(param, value) {
            const valueElement = document.getElementById(param + 'Value');
            if (param === 'minSpeechMs' || param === 'preSpeechPadMs') {
                valueElement.textContent = value + 'ms';
            } else {
                valueElement.textContent = value;
            }
        }
        
        function applyVADConfig() {
            // æ›´æ–°é…ç½®å¯¹è±¡
            vadConfig.positiveSpeechThreshold = parseFloat(document.getElementById('positiveThreshold').value);
            vadConfig.negativeSpeechThreshold = parseFloat(document.getElementById('negativeThreshold').value);
            vadConfig.minSpeechMs = parseInt(document.getElementById('minSpeechMs').value);
            vadConfig.preSpeechPadMs = parseInt(document.getElementById('preSpeechPadMs').value);
            
            // å¦‚æœVADæ­£åœ¨è¿è¡Œï¼Œéœ€è¦é‡å¯æ‰èƒ½åº”ç”¨æ–°é…ç½®
            if (isListening) {
                showInfo('é…ç½®å·²ä¿å­˜ï¼Œéœ€è¦é‡å¯VADæ‰èƒ½ç”Ÿæ•ˆ');
                logDebug('VADé…ç½®å·²æ›´æ–°ï¼Œéœ€è¦é‡å¯');
            } else {
                showInfo('é…ç½®å·²ä¿å­˜');
                logDebug('VADé…ç½®å·²æ›´æ–°');
            }
            
            // éšè—é…ç½®é¢æ¿
            document.getElementById('configPanel').style.display = 'none';
            
            addDebugLog(`é…ç½®æ›´æ–°: è¯­éŸ³é˜ˆå€¼=${vadConfig.positiveSpeechThreshold}, æœ€å°æ—¶é•¿=${vadConfig.minSpeechMs}ms`);
        }
        
        function resetVADConfig() {
            // é‡ç½®ä¸ºé»˜è®¤å€¼
            vadConfig = {
                positiveSpeechThreshold: 0.3,
                negativeSpeechThreshold: 0.25,
                redemptionMs: 1400,
                preSpeechPadMs: 800,
                minSpeechMs: 400,
                model: "v5"
            };
            
            // æ›´æ–°UI
            loadCurrentConfig();
            showInfo('é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
            logDebug('VADé…ç½®å·²é‡ç½®');
            addDebugLog('é…ç½®é‡ç½®ä¸ºé»˜è®¤å€¼');
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', function() {
            if (vadInstance) {
                vadInstance.pause();
            }
            
            // é‡Šæ”¾æ‰€æœ‰éŸ³é¢‘URL
            recordings.forEach(rec => URL.revokeObjectURL(rec.audioUrl));
            
            logDebug('é¡µé¢å¸è½½ï¼Œèµ„æºå·²æ¸…ç†');
        });

        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            // Ctrl+Enter å¼€å§‹/åœæ­¢ç›‘å¬
            if (event.ctrlKey && event.key === 'Enter') {
                event.preventDefault();
                const isListening = vadInstance ? vadInstance.listening : false;
                if (isListening) {
                    stopVAD();
                } else {
                    startVAD();
                }
            }
            
            // Escape é”®åœæ­¢ç›‘å¬
            if (event.key === 'Escape') {
                const isListening = vadInstance ? vadInstance.listening : false;
                if (isListening) {
                    event.preventDefault();
                    stopVAD();
                }
            }
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æç¤º
        document.addEventListener('DOMContentLoaded', function() {
            const controlsDiv = document.querySelector('.controls');
            const shortcutHint = document.createElement('div');
            shortcutHint.style.cssText = `
                font-size: 12px;
                color: #6b7280;
                margin-top: 8px;
            `;
            shortcutHint.innerHTML = 'ğŸ’¡ å¿«æ·é”®: Ctrl+Enter å¼€å§‹/åœæ­¢ç›‘å¬, Esc åœæ­¢ç›‘å¬';
            controlsDiv.appendChild(shortcutHint);
        });
    </script>
</body>
</html>
        }

        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            
            // æ£€æŸ¥VADå®ä¾‹çš„å®é™…å±æ€§
            const isListening = vadInstance ? vadInstance.listening : false;
            
            // æ£€æŸ¥VADå®ä¾‹çš„æ‰€æœ‰å¯æšä¸¾å±æ€§
            const vadInstanceProps = vadInstance ? Object.keys(vadInstance) : [];
            const vadInstanceValues = {};
            
            if (vadInstance) {
                // è·å–VADå®ä¾‹çš„æ‰€æœ‰å±æ€§å€¼
                for (let key in vadInstance) {
                    if (vadInstance.hasOwnProperty(key)) {
                        vadInstanceValues[key] = vadInstance[key];
                    }
                }
            }
            
            debugDiv.innerHTML = `
                <div style="background: white; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <strong>è°ƒè¯•ä¿¡æ¯:</strong><br>
                    - window.vad: ${window.vad ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}<br>
                    - window.vad.MicVAD: ${window.vad && window.vad.MicVAD ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}<br>
                    - vadInstance: ${vadInstance ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}<br>
                    - listening: ${isListening}<br>
                    - VADå®ä¾‹å±æ€§: ${vadInstanceProps.length > 0 ? vadInstanceProps.join(', ') : 'æ— '}<br>
                    - éŸ³é¢‘é‡‡æ ·ç‡: 16000Hz<br>
                    - å½“å‰æ—¶é—´: ${new Date().toLocaleString()}
                    ${vadInstanceProps.length > 0 ? `<br><strong>VADå®ä¾‹å±æ€§å€¼:</strong><br>` : ''}
                    ${vadInstanceProps.map(prop => `- ${prop}: ${JSON.stringify(vadInstanceValues[prop])}`).join('<br>')}
                </div>
            `;
        }

        // é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('å…¨å±€é”™è¯¯:', message, 'at', source, 'line', lineno);
            updateVADStatus('error', 'âŒ å‘ç”Ÿé”™è¯¯: ' + message);
        };
    </script>
</body>
</html>